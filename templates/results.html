{% extends "base.html" %} {% block title %}Analysis Results{% endblock %} {%
block content %}
<div class="text-center mb-4">
  <h1 class="text-dark">Aadhaar Analysis Report</h1>
  <p class="text-muted">File: {{ filename }}</p>
</div>

{% if results.assessment == 'HIGH FRAUD RISK' %}
<div class="fraud-indicator high-risk">
  <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
  <div>
    <h4 class="mb-0">{{ results.assessment }}</h4>
    <span>Based on a fraud score of {{ results.fraud_score }}</span>
  </div>
</div>
{% elif results.assessment == 'MODERATE FRAUD RISK' %}
<div class="fraud-indicator moderate-risk">
  <i class="fas fa-exclamation-circle fa-2x me-3"></i>
  <div>
    <h4 class="mb-0">{{ results.assessment }}</h4>
    <span>Based on a fraud score of {{ results.fraud_score }}</span>
  </div>
</div>
{% else %}
<div class="fraud-indicator low-risk">
  <i class="fas fa-check-circle fa-2x me-3"></i>
  <div>
    <h4 class="mb-0">{{ results.assessment }}</h4>
    <span>Based on a fraud score of {{ results.fraud_score }}</span>
  </div>
</div>
{% endif %}

<div class="row">
  <div class="col-md-6">
    <div class="analysis-card text-center">
      <h5>Annotated Front Image</h5>
      <hr />
      {% if annotated_image_filename_front %}
      <img
        src="{{ url_for('static', filename=annotated_image_filename_front) }}"
        class="img-fluid rounded"
        alt="Annotated Front of Aadhaar Card"
      />
      {% else %}
      <p class="text-muted">Annotated front image not available.</p>
      {% endif %}
    </div>
  </div>
  <div class="col-md-6">
    <div class="analysis-card text-center">
      <h5>Annotated Back Image</h5>
      <hr />
      {% if annotated_image_filename_back %}
      <img
        src="{{ url_for('static', filename=annotated_image_filename_back) }}"
        class="img-fluid rounded"
        alt="Annotated Back of Aadhaar Card"
      />
      {% else %}
      <p class="text-muted">Annotated back image not available.</p>
      {% endif %}
    </div>
  </div>
</div>

<div class="row">
  <div class="col-lg-7">
    <div class="analysis-card">
      <h5>
        <i class="fas fa-search me-2"></i>Custom Object Verification (Front)
      </h5>
      <hr />
      {% if results.front.object_verification and 'error' not in
      results.front.object_verification %}
      <p>
        <strong>Tampering Detected:</strong>
        {% if results.front.object_verification.is_tampered %}
        <span class="badge bg-danger">üö® Yes</span>
        {% else %}
        <span class="badge bg-success">‚úÖ No</span>
        {% endif %}
      </p>
      <p><strong>Detected Objects:</strong></p>
      <div>
        {% for obj in results.front.object_verification.detected_objects or []
        %}
        <span class="badge bg-primary me-2 mb-2">{{ obj }}</span>
        {% else %}
        <span class="text-muted">None</span>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-warning">
        Could not run custom object verification analysis.
      </p>
      {% endif %}
    </div>

    <div class="analysis-card">
      <h5>Object Detection Results</h5>
      <hr />
      {% if results.front.face_detection and 'error' not in
      results.front.face_detection and
      results.front.face_detection.detected_objects %} {% for key, value in
      results.front.face_detection.items() %}
      <p>
        <strong>{{ key|replace('_', ' ')|capitalize }}:</strong>
        <code>{{ value }}</code>
      </p>
      {% endfor %} {% else %}
      <p class="text-warning">Could not detect objects using YOLO.</p>
      {% endif %}
    </div>

    <div class="analysis-card">
      <h5><i class="fas fa-keyboard me-2"></i>OCR & Aadhaar Validation</h5>
      <hr />
      {% if results.combined_ocr and 'error' not in results.combined_ocr %} {%
      for key, value in results.combined_ocr.items() %}
      <p><strong>{{ key }}:</strong> <code>{{ value }}</code></p>
      {% endfor %} {% if results.aadhaar_validation %}
      <p>
        <strong>Checksum Valid:</strong>
        {% if results.aadhaar_validation.valid %}
        <span class="badge bg-success">‚úÖ Yes</span>
        {% else %}
        <span class="badge bg-danger">‚ùå No</span>
        {% endif %} (Reason: {{ results.aadhaar_validation.reason }})
      </p>
      {% endif %} {% else %}
      <p class="text-warning">Could not extract text via OCR.</p>
      {% endif %}
    </div>
  </div>

  <div class="col-lg-5">
    <div class="analysis-card">
      <h5><i class="fas fa-qrcode me-2"></i>QR Code Analysis (Back)</h5>
      <hr />
      {% if results.back.qr_analysis and 'error' not in results.back.qr_analysis
      %} {% for key, value in results.back.qr_analysis.items() if key !=
      'raw_xml' %}
      <p><strong>{{ key|capitalize }}:</strong> <code>{{ value }}</code></p>
      {% endfor %} {% else %}
      <p class="text-warning">
        {{ results.back.qr_analysis.error if results.back.qr_analysis else 'QR
        analysis failed.' }}
      </p>
      {% endif %}
    </div>

    <div class="analysis-card">
      <h5><i class="fas fa-flag me-2"></i>Fraud Indicators</h5>
      <hr />
      {% if results.fraud_indicators %}
      <ul class="list-group list-group-flush">
        {% for indicator in results.fraud_indicators %}
        <li class="list-group-item text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>{{ indicator }}
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-success">‚úÖ No specific fraud indicators were found.</p>
      {% endif %}
    </div>
  </div>
</div>

<div class="text-center mt-4">
  <a href="/" class="btn btn-analyze">
    <i class="fas fa-arrow-left me-2"></i>Analyze Another Image
  </a>
</div>

{% endblock %}
