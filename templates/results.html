{% extends "base.html" %} {% block content %}
<div class="text-center mb-4">
  <h1 class="display-5">
    <i class="fas fa-search-plus text-primary"></i>
    Analysis Results
  </h1>
  <p class="text-muted">File: {{ filename }}</p>
</div>

<!-- Overall Assessment -->
<div
  class="fraud-indicator {% if results.assessment == 'HIGH FRAUD RISK' %}high-risk{% elif results.assessment == 'MODERATE FRAUD RISK' %}moderate-risk{% else %}low-risk{% endif %}"
>
  <div class="row align-items-center">
    <div class="col-auto">
      {% if results.assessment == 'HIGH FRAUD RISK' %}
      <i class="fas fa-exclamation-triangle fa-2x"></i>
      {% elif results.assessment == 'MODERATE FRAUD RISK' %}
      <i class="fas fa-exclamation-circle fa-2x"></i>
      {% else %}
      <i class="fas fa-check-circle fa-2x"></i>
      {% endif %}
    </div>
    <div class="col">
      <h3 class="mb-1">{{ results.assessment }}</h3>
      <p class="mb-0">Fraud Score: {{ results.fraud_score }}/5</p>
    </div>
  </div>
</div>

<!-- Fraud Indicators -->
{% if results.fraud_indicators %}
<div class="analysis-card">
  <h4 class="text-danger">
    <i class="fas fa-flag me-2"></i>Fraud Indicators Found
  </h4>
  <ul class="list-group list-group-flush">
    {% for indicator in results.fraud_indicators %}
    <li class="list-group-item">
      <i class="fas fa-exclamation-triangle text-warning me-2"></i>
      {{ indicator }}
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<!-- EXIF Analysis -->
<div class="analysis-card">
  <h4><i class="fas fa-camera text-info me-2"></i>EXIF Metadata Analysis</h4>
  {% if results.exif_analysis and "error" not in results.exif_analysis %} {% if
  results.exif_analysis %}
  <div class="table-responsive">
    <table class="table table-sm">
      <thead>
        <tr>
          <th>Property</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        {% for key, value in results.exif_analysis.items() %}
        <tr>
          <td><strong>{{ key }}</strong></td>
          <td>{{ value }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-warning">
    <i class="fas fa-info-circle me-2"></i>
    No EXIF metadata found. This could indicate digital manipulation.
  </div>
  {% endif %} {% else %}
  <div class="alert alert-danger">
    <i class="fas fa-exclamation-triangle me-2"></i>
    EXIF Analysis Error: {{ results.exif_analysis.error if "error" in
    results.exif_analysis else "Unknown error" }}
  </div>
  {% endif %}
</div>

<!-- OCR Analysis -->
<div class="analysis-card">
  <h3>üìÑ OCR Analysis</h3>
  <div class="extracted-info">
    <h4>Extracted Information:</h4>

    <p>
      <strong>Name:</strong>
      {% if 'Name' in results.ocr_analysis %} {{ results.ocr_analysis['Name'] }}
      {% else %} Not detected {% endif %}
    </p>
    <p>
      <strong>Date of Birth:</strong>
      {% if 'Date of Birth' in results.ocr_analysis %} {{
      results.ocr_analysis['Date of Birth'] }} {% else %} Not detected {% endif
      %}
    </p>
    <p>
      <strong>Gender:</strong> {{ results.ocr_analysis.get('Gender', 'Not
      detected') }}
    </p>
    <p>
      <strong>Aadhaar Number:</strong>
      {% if 'Aadhaar Number' in results.ocr_analysis %} {{
      results.ocr_analysis['Aadhaar Number'] }} {% else %} Not detected {% endif
      %}
    </p>
    {% if results.aadhaar_validation %}
    <p>
      <strong>Aadhaar Number Validation:</strong>
      {% if results.aadhaar_validation.valid %}
      <span class="badge bg-success">
        ‚úÖ {{ results.aadhaar_validation.reason }}
      </span>
      <br />
      <small
        >Cleaned Number: {{ results.aadhaar_validation.clean_number }}</small
      >
      {% else %}
      <span class="badge bg-danger">
        ‚ùå {{ results.aadhaar_validation.reason }}
      </span>
      {% endif %}
    </p>
    {% endif %}
  </div>

  <!-- Show Raw OCR Data for debugging -->
  <details>
    <summary>Show Raw OCR Text</summary>
    <pre>{{ results.ocr_analysis }}</pre>
  </details>
  <details>
    <summary>Aadhaar Number Validation Details</summary>
    <pre>{{ results.aadhaar_validation }}</pre>
  </details>
</div>

<!-- Object Detection -->
<div class="analysis-card">
  <h4><i class="fas fa-eye text-warning me-2"></i>Object Detection (YOLO)</h4>
  {% if "error" not in results.object_detection %}
  <div class="row">
    <div class="col-md-6">
      <strong>Detected Objects:</strong>
      {% if results.object_detection.detected_objects %}
      <div class="mt-2">
        {% for obj in results.object_detection.detected_objects %}
        <span class="badge bg-secondary me-1">{{ obj }}</span>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted mt-2">No objects detected</p>
      {% endif %}
    </div>
    <div class="col-md-6">
      <strong>Human Detection:</strong>
      <div class="mt-2">
        {% if results.object_detection.human_detected %}
        <span class="badge bg-success">
          <i class="fas fa-user me-1"></i>Human Detected
        </span>
        {% else %}
        <span class="badge bg-warning">
          <i class="fas fa-user-slash me-1"></i>No Human Detected
        </span>
        {% endif %}
      </div>
    </div>
  </div>
  {% else %}
  <div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle me-2"></i>
    Object Detection Error: {{ results.object_detection.error }}
  </div>
  {% endif %}
</div>

<!-- SSIM Analysis -->
<div class="analysis-card">
  <h4><i class="fas fa-equals text-success me-2"></i>SSIM Analysis</h4>

  {% if results.ssim_analysis %}
  <p>
    <strong>Best Match Template:</strong>
    {{ results.ssim_analysis.best_match_template }}
  </p>
  <p>
    <strong>Best SSIM Score:</strong>
    {{ results.ssim_analysis.best_score | round(2) }}
  </p>
  <p>
    <strong>Validity:</strong>
    {% if results.ssim_analysis.validity %}
    <span class="badge bg-success">‚úÖ Valid Layout</span>
    {% else %}
    <span class="badge bg-danger">‚ùå Possible Tampering</span>
    {% endif %}
  </p>

  <details>
    <summary>Show All SSIM Scores</summary>
    <pre>{{ results.ssim_analysis.all_scores }}</pre>
  </details>
  {% else %}
  <div class="alert alert-warning">
    <i class="fas fa-info-circle me-2"></i>
    SSIM analysis not available.
  </div>
  {% endif %}
</div>

<div class="text-center mt-4">
  <a href="{{ url_for('home') }}" class="btn btn-primary btn-lg">
    <i class="fas fa-upload me-2"></i>
    Analyze Another Image
  </a>
</div>
{% endblock %}
